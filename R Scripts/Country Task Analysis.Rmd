---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
library(readxl)
```


Find the datafiles

```{r}

list_of_performance_data <- list.files(path = "G:/Team Drives/Research Team/Projects/2018 Driving Sim Reproducibility/4_Analysis_Saccades/Task Response Data", recursive = TRUE, full.names = TRUE)

Filename_Database <- read_excel("G:/Team Drives/Research Team/Projects/2018 Driving Sim Reproducibility/File Reference Database.xlsx", sheet = 1)


Country_database <- Filename_Database %>% 
    filter(Scenario == "Country") %>% 
    mutate(file_exist = file.exists(paste0("G:/Team Drives/Research Team/Projects/2018 Driving Sim Reproducibility/4_Analysis_Saccades/Task Response Data/",Task_Pattern,"_Prosaccade_Results_var.csv")))

```

Import the data

```{r}

taskresponse_colnames <- c("trial number", "tTRIG", "tTIME", "tCorr", 
                            "Corr_tTIME", "rKey", "rSecs","rTIME", 
                            "rCorr", "Corr_rTIME", "rDir", "Condition" )

pattern_name <- Country_database$Task_Pattern[52]

raw_file <- read_csv(paste0("G:/Team Drives/Research Team/Projects/2018 Driving Sim Reproducibility/4_Analysis_Saccades/Task Response Data/",pattern_name,"_Prosaccade_Results_var.csv"), col_names = taskresponse_colnames )

raw_file$task_condition <- ifelse(raw_file$rDir == 2,
                                          raw_file$Condition + 12, 
                                          raw_file$Condition)
raw_file$task_arrow_dir <- ifelse(raw_file$rDir == 1, "Left", "Right")
raw_file$stimulus_left_right <- ifelse(raw_file$Condition <= 6, "Left", "Right")
raw_file$reaction_time <- raw_file$Corr_rTIME - raw_file$Corr_tTIME
raw_file$congruency <- ifelse(raw_file$task_arrow_dir == raw_file$stimulus_left_right, "Congruent", "Incongruent")
raw_file$target_deviation <- ifelse(raw_file$Condition %% 3 == 1, "10", 
                                            ifelse(raw_file$Condition %% 3 == 2, "25",
                                                   ifelse(raw_file$Condition %% 3 == 0, "35", NA))) %>% as.numeric()
raw_file$response_type <- ifelse(raw_file$rDir == raw_file$rKey,"Correct",
                        ifelse((raw_file$rKey == 0), "Miss",
                        ifelse((raw_file$rKey > 0) & (raw_file$rKey != raw_file$rDir),"Incorrect", NA)))


raw_file %>% 
    group_by(congruency) %>% 
    summarise(percent_correct = mean(response_type == "Correct", na.rm = TRUE), 
                       percent_miss = mean(response_type == "Miss", na.rm = TRUE),
                       percent_incorrect = mean(response_type == "Incorrect", na.rm = TRUE))

raw_file %>% group_by(response_type) %>% summarise(reaction_time = mean(reaction_time, na.rm = TRUE))
```


