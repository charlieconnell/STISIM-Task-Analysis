---
title: "STISIM-Dat-File-Cleaining"
author: "Hayden Green"
date: "18 July 2018"
output: html_document
---

## Data Cleaning File
### Import the Packages 

```{r results='hide', error=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
```

### Creating the Column Names
Define the column names and then sorting them in a more preferred order.
test to push into github

```{r results='hide'}
Columns <- c("Elapsed_Time","Longitudinal_Accel","Lateral_Accel","Longitudinal_Veloc","Lateral_Veloc","Total_dist","Lateral_Lane_Pos","Vehic_curve","Road_Curve","Steering_angle","Throttle_input","Brake_input","Crashes_comp","Marker","Speed","Steering_count","Throttle_count","Brake_Count","System_Time","RT","Trigger_Number","Speed_Limit","Left_indicator","Right_Indicator", "Driving_Tickets")

sorted_columns <- c("Elapsed_Time","Total_dist","Longitudinal_Veloc","Speed","Longitudinal_Accel", "Lateral_Lane_Pos", "Lateral_Veloc", "Lateral_Accel", "Throttle_input", "Brake_input", "Steering_angle","Throttle_count", "Brake_Count", "Steering_count", "Left_indicator", "Right_Indicator","Vehic_curve","Road_Curve", "Speed_Limit","Driving_Tickets", "Trigger_Number", "Crashes_comp", "Marker", "RT","System_Time")
```

### Choose the raw data file to be cleaned

```{r}
filename <- file.choose()
```

### Import the file
The file is imported, the start and end of the numerical raw data file is idenitifed and selected into a data frame called "cleaned_data", it is sorted based on the vector "Sorted_columns" above.

```{r}
raw_data <- read.table(filename, sep = "", col.names = Columns, header = FALSE, fill = TRUE, blank.lines.skip = FALSE, stringsAsFactors = FALSE)

data_start <- raw_data[raw_data$Elapsed_Time == "Block",] %>% 
  row.names.data.frame() %>% 
  as.numeric() + 2

data_end <- raw_data[raw_data$Elapsed_Time == "Tailgating",] %>% 
  row.names.data.frame() %>% 
  as.numeric() - 3

cleaned_data <- raw_data[data_start:data_end,sorted_columns]


cleaned_data %>% str()
cleaned_data %>% head()
cleaned_data %>% tail()
```

### Get the summary data of performance and violations.
Reads the file into a character string format then select lines starting from the start of the summary data in the file to the end of the file. 

```{r}
raw_txt <- readLines(filename)
last_line <- length(raw_txt)
summary_report <- raw_txt[grep("Tailgating results",raw_txt):last_line]

summary_report %>% head()

summary_report %>% tail()
```

### Obtain the name & path of the data file and create file nimes for the cleaned data

```{r}
Participant_ID <- raw_data[3,2]
Run_number <- raw_data[10,3]

data_filename <- paste(Participant_ID, Run_number, "cleaned", sep = "_")
summary_filename <- paste(Participant_ID, Run_number, "summary", sep = "_")
Pattern <- paste(Participant_ID,"_",Run_number,".Dat", sep = "")
path <- filename %>% str_replace(Pattern, "")
```

### Write the cleaned and summary data into a csv and .txt 
The raw csv file is "..._cleaned.csv" with the .txt file in "..._summary.txt" file.

```{r}
cleaned_data %>% write.csv(file = paste(path,data_filename,".csv", sep = ""), row.names = FALSE)
write(summary_report,file = paste(path,summary_filename, ".txt",sep = ""))
```
