---
title: "R Notebook"
output: html_notebook
---


```{r, results='hide'}

library(tidyverse)
library(readxl)
library(lme4)
library(lmerTest)
library(psych)

```

Get the Reference Database

```{r}
 
Filename_Database <- read_excel("G:/Team Drives/Research Team/Projects/2018 Driving Sim Reproducibility/File Reference Database.xlsx", 
                                 sheet = 1)

Country_database <- Filename_Database %>% filter(Scenario == "Country")


find_saccade_csv_filename <- function(x) {
   y <-  list.files(path = "G:\\Team Drives\\Research Team\\Projects\\2018 Driving Sim Reproducibility\\4_Analysis_Saccades\\", 
           pattern = paste0(x,"_Prosaccade_final.csv"), 
           full.names = TRUE, recursive = TRUE)
    z <- if_else(length(y) == 0, "NA", y[1]) %>% as.character()
     z
    }


Country_database$final_csvs <- Country_database$Saccade_pattern %>% lapply(find_saccade_csv_filename)

importing_df <- Country_database %>% select(Participant, Session, Run, final_csvs)


```

Load the Data

```{r}

create_database_saccades <- function (Participant, Session, Run, final_csvs) {
   
 filename <- final_csvs %>% as.character()   
  df <- read_csv(filename)
  df$ID <- Participant %>% as.character()
  df$Session <- Session %>% as.character()
  df$Run <- Run %>% as.character()
  
 df
}

saccades_database <- importing_df %>% 
    filter(final_csvs != "NA") %>%
    pmap_df(~create_database_saccades(..1,..2,..3,..4))

saccades_database$saccade_size <- if_else((saccades_database$amplitude >7.5) & (saccades_database$amplitude < 12.5), "10",
                                         if_else((saccades_database$amplitude > 22.5) & (saccades_database$amplitude < 27.5), "25",
                                         if_else((saccades_database$amplitude > 32.5) & (saccades_database$amplitude < 37.5), "35","NA")))

```

sifting down the data

```{r}

summarised <- saccades_database %>% 
    filter(`peak_dva/s` < 1500) %>%
    filter(`dva/s` < 1500) %>%
    group_by(ID, Session, Run) %>%
    #group_by(saccade_size) %>%
    summarise(max_velocity = mean(`peak_dva/s`),
              mean_velocity = mean(`dva/s`))
    #filter(saccade_size != "NA")


summarised
```

Statistical analyses

```{r}



```

